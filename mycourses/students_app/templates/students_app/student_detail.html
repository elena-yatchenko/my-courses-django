{% extends "base.html" %}

{% block content %}
<h1>Студент: {{ student.full_name }}</h1>
{% if student.photo %}
<p class="photo">
    <img src="{{ student.photo.url }}" class="img-responsive" style="width: 30%; float: right; margin-right: 80px;"
        alt="Ваше фото">
</p>
{% endif %}
<p><strong>Телефон:</strong> {{student.phone}}</p>
<p><strong>E-mail:</strong> {{student.related_user.email}}</p>
<p><strong>Дата рождения:</strong> {{student.date_of_birth|date:"d.m.Y"}} г.</p>
{% if student.status == 'r' %}
<br>
<p><strong>Дата подачи заявки:</strong> {{student.request_date|date:"d.m.Y"}} г.</p>
<button type="button"><a href="{% url 'student-approve' student.pk %}?next={{request.path}}">
        Обработать заявку</a></button>
{% else %}
<div style="margin-top:20px; margin-bottom:20px;">
    <p><strong>Курс:</strong> {{student.course }}</p>
    <p><strong>Дата регистрации:</strong> {{student.reg_date|date:"d.m.Y"}} г.</p>
    <p><strong>Средний балл:</strong> {{student.average_mark}}</p>
</div>
{% if student.status == 'f' %}
<div style="margin-top:20px; margin-bottom:20px;">
    <p class="text-danger"><strong>Студент в архиве</strong></p>
</div>
{% endif %}
<hr>
<p class="{% if student.is_paid %}text-success{% elif not payments %}text-danger{% else %}text-warning{% endif %}">
    Статус оплаты: {% if student.is_paid %}Оплачено полностью
    {% elif not payments %}Оплаты нет
    {% else %}Оплачено частично{% endif %}</p>
{% if perms.students_app.add_payment and perms.students_app.change_payment %}
<p><a href="{% url 'student-payment' student.id  %}">Добавить данные по оплате</a></p>
{% endif %}
<hr>
<div style="margin-left:20px;margin-top:20px">
    <h4><strong>Данные оплаты</strong></h4>
    <br>
    <p class="text-success"><strong>Общая стоимость обучения: {{ student.course.total_cost}} азн</strong>
    </p>
    <p class="text-warning"><strong>Остаток для оплаты: {{ student.rest_of_payment}} азн</strong>
    </p>

    {% if payments %}
    <p><b>ПЛАТЕЖИ</b></p>

    {% for payment in payments %}
    <ol>
        <li><strong>Сумма: </strong>{{ payment.amount }} азн
            <button type="button" style="margin-left:80px"><a href="{% url 'payment-update' student.id payment.id %}">
                    Редактировать данные</a></button>
            <ul>
                <li>Дата:
                    </strong>{{ payment.paid_date|date:"d.m.Y" }} г.</li>
                <li>{% if payment.document %}<strong>Документ, подтверждающий оплату: </strong>
                    <a href="{{ payment.document.url }}">{{ payment.document.name }}</a>
                    {% else %}<p class="text-danger">(документ, подтверждающий оплату, отсутствует){% endif %}</p>
                </li>
            </ul>
        </li>
    </ol>
    {% endfor %}
    {% else %}<p class="text-danger"><b>Нет зарегистрированных платежей!</b></p>
    {% endif %}
</div>
{% endif %}
{% endblock %}