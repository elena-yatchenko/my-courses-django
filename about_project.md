# Приложение 'Курсы обучения (программа 1С)'
Модели: студент, категория, курс, оплата, оценка, Отзыв
суперюзер - full_admin, 123456123

username - finalcourses
email - на mail.ru
password - Леголас (к базе данных тоже)
admin full_admin, admin123456
users 111user111 и т.п.
ссылка на сайт - finalcourses.pythonanywhere.com

Данное приложение представляет собой **сайт для компании, которая проводит курсы обучения
по программе 1С**.

Актуальность в том, что компания реальная, я в ней работаю в настоящее время, и хотя 
сейчас функционал сайта довольно ограниченный, его можно расширять и примерять в работе. 

## Модели
В приложение включены следующие модели:
1) Категория курса (Category) 
Поля:
* наименование
* флаг категории (метка для отборов)

2) Курс (Course)
Поля:
* наименование
* категория (внешний ключ)
* описание курса
* продолжительность курса, в мес.
* стоимость в месяц, азн.
* дата создания
* галочка "is_deleted" (например, чтобы закрыть курс вместо полного удаления из базы)
* дата удаления (закрытия)
* рейтинг курса - недоступно для редактирования через админ панель, рассчитывается автоматически при добавлении отзыва
* количество просмотров 
Кроме того, модель Курс включает встроенные **методы расчет общей стоимости курса, расчет рейтинга и get_absolute_url** (получение URL-адреса для отображения страницы конкретного курса)

3) Студент (Student)
Поля:
* связанный пользователь (внешний ключ)
* имя 
* фамилия 
* телефон
* дата рождения
* курс (внешний ключ)
* фото
* полное имя (full_name, @property)
* статус - выбор из набора значений (устанавливаются автоматически)

Статусы устанавливаются автоматически:
- при подаче заявки - requested,
- при подтверждении заявки - approved (кроме того, происходит автоматическое добавление в группу Students)
- при подтверждении завершения обучения - finished (кроме того, происходит автоматическое удаление из группы Students и перевод в группу Archive)

* дата запроса (подачи заявки)
* дата регистрации (подтверждение заявки, начало обучения)
* дата обновления (при внесении изменений в запись)
* галочка "is_deleted" (деактивация вместо полного удаления из базы)
* дата удаления (деактивации)
* признак завершения обучения (is_finished, @property) - расчитывается с учетом даты регистрации и продолжительности курса. Студенты, у которых этот признак = True, выводятся на панели навигации отдельным списком (видимость только для сотрудников, is_staff) с возможностью добавить их в архив (по кнопке "Добавить в архив"). 
Дана возможность ручного подтверждения завершения обучения, т.к. могут быть незакрытые вопросы по документам, оплате и проч. Но при этом сотрудник знает, что период обучения студента завершен. По этому признаку можно также закрывать доступы к каким-то материалам, например (не реализовано). 

Кроме того, модель Студент включает встроенные **методы расчет среднего балла студента, расчет остатка к оплате и get_absolute_url** (получение URL-адреса для отображения страницы конкретного студента)

4) Успеваемость студента (Performance)
Поля:
* оценка - выбор из набора значений
* студент (внешний ключ)
* дата оценки
* дата изменения (в перспективе доработка для возможности корректировки оценок)

5) Оплата (Payment)
Поля:
* студент (внешний ключ)
* сумма оплаты
* дата оплаты
* документ, подтверждающий оплату - файл (с выведением по ссылке в личном кабинете и на странице детальной информации о студенте)
* дата добавления
* дата изменения
Предусмотрено внесение оплаты по частям

6) Отзыв (Review)
Поля: 
* студент (внешний ключ), который оставил отзыв (сотрудники оставлять или редактировать отзывы не могут)
* курс (внешний ключ), к которому относится отзыв
* текст отзыва
* оценка - выбор из набора значений
* дата добавления
Модель Отзыв включает также встроенный **метод выведения только части содержимого текста**

## Общий функционал
Описание полного функционала, который предоставляется приложением.
Сайт включает 4 вкладки: 
### Главная 
Отображается приветствие и  причины для изучения 1 С (мотивация), в дальнейшем планируется добавить карусель из 5 
наиболее популярных курсов (по количеству просмотров);
### Курсы 
Вкладка при нажатии отображает доступные Категории курсов. При выборе категории открывается страница 
со списком курсов **выбранной категории**. Для каждого курса в списке показано Наименование, Продолжительность обучения, 
а также кнопка "Добавить оценки по курсу". 

Кнопка "Добавить оценки по курсу" перенаправляет на страницу с формой для добавления оценок. Причем, к выбору доступны только **студенты выбранного курса**. При добавлении оценки конкретному студенту, форма открывается для добавления  оценки другому студенту этого же курса.  

Чтобы завершить работу с формой и вернуться на страницу списка курсов, пользователю необходимо нажать кнопку "Завершить". 

На странице со списком курсов Наименование курса является активной ссылкой, которая открывает страницу с детальной информацией
по выбранному курсу. А именно: 
1) Общая информация по курсу: 
- Наименование
- Категория
- Краткое описание
- Продолжительность обучения
- Полная стоимость обучения
- Рейтинг (обновляется автоматически при добавлении нового отзыва о курсе).
- Количество просмотров
- кнопка "Подать заявку". 

При **подаче заявки** добавлена проверка: если для этого пользователя на данном курсе уже зарегистрирован студент со статусом "approved" (активный студент) либо со статусом "requested" (подана заявка на обучение), выводится соответствующее сообщение и заявка не регистрируется. 
Если по выбранному курсу для пользователя студент не зарегистрирован, то откроется форма для регистрации нового студента. 
При этом в форме Имя, Фамилия и Электронная почта заполнены по умолчанию (с возможностью изменения) соответствующими значениями для пользователя. 

Результат успешной отправки формы - создается экземпляр модели Student с указанными данными, статус по умолчанию устанавливается 'r' (requested) и происходит перенаправление в Личный кабинет пользователя. 

2) Отзывы: 
- Форма для добавления нового отзыва (доступна ТОЛЬКО для студентов):
* комментарий
* оценка (от 1 до 5) - при добавлении нового отзыва автоматически пересчитывается Рейтинг курса

- Комментарии (пользователь, дата добавления, оценка, текст комментария)

3) Студенты - список активных (статус 'а' - approved) студентов данного курса с указание ФИО и среднего балла студента. 
Если на данном курсе активных студенов нет, выводится соответствующее сообщение. 
ФИО студента является активной ссылкой, которая ведет на страницу с детальной информацией по данному студенту. Описание детальной страницы студента дано ниже по тексту. 

### Контакты 
Добавлены контакты (адрес, телефон, эл.почта контактного лица) - тестово.

### Личный кабинет
Открывается личный кабинет с детальной информацией студента. Если студент обучается/ обучался/ подал заявку на обучение
более, чем на одном курсе, вся информация будет предоставлена в разрезе курсов. 
В личном кабинете отражаются следующие данные: 
* фото;
* кнопка "Добавить фото" (если фото отсутствует) - переводит на форму добавления фото;
* ссылка "Редактировать фото" - если фото есть - переводит на форму добавления фото, фото заменяется;
* телефон;
* эл.почта;
* дата рождения;

Для тех, кто еще только подал заявку на обучение, но не подтвержден: 
- дата подачи заявки;
- сообщение, что заявка находится на рассмотрении.

Для активных студентов и студентов, находящихся в архиве:
- дата регистрации;
- средний балл (успеваемость) - пересчитывается автоматически при добавлении новых оценок;
- пометка "Обучение завершено" (только для студентов в архиве);
- статус оплаты (оплачено частично, оплачено полностью, оплаты нет) - данный статус автоматически оперделяется при добавлении платежей;
- блок "Данные оплаты", где отражается информация: 
* общая стоимость обучения;
* остаток для оплаты;
* данные по платежам (если платежей нет - соответствующее сообщение):
- сумма;
- дата оплаты;
- документ, подтверждающий оплату (ссылка). Если документ (файл) отсутствует, выводится соответствующее сообщение;

Помимо вкладок, есть следующие разделы (представлены на боковой панели навигации):
#### Авторизация
- Имя пользователя;
- Ссылки на Вход / Выход
По ссылке "Вход" идет переадресация на форму аутентификации пользователя (логин, пароль). Там же есть ссылка для 
позможности регистрации, если пользователь еще не существует. В форме регистрации добавлено поле подтверждения пароля и верификация на совпадение пароля и его подтверждения. 

По ссылке "Выход" производится выход и перенаправление на главную страницу сайта.
#### Обучение 
Видимость данного раздела - только для сотрудников (is_stuff).
Раздел содержит 3 ссылки: 
- Заявки на обучение (с указанием количества, если заявки есть);
- Студенты;
- Архив.

Каждая из ссылок ведет на страницу со списком студентов, информация на которой изменяется в зависимости от статуса студента (required, approved, finished).

##### Заявки на обучение
Происходит перенаправление на страницу, которая **в разрезе курсов** отображает список людей, которые подали заявки на обучение (статус required).
Указывается Курс, фамилия и имя студента, дата подачи заявки. 
Тут же выводится **кнопка "Обработать заявку"**, которая перенаправляет на форму подтверждения заявки. 
При выборе варианта "Принять" происходит:
* изменение статуса студента на 'approved';
* устанавливается текущая дата в качестве даты регистрации;
* пользователь добавляется в группу Students.
##### Студенты
По ссылке проиходит переход на страницу, которая **в разрезе курсов** отображает список активных студентов, (статус approved).
Для каждого студента указывается курс, фамилия и имя студента, дата регистрации. 
Тут же для студентов, период обучения которых завершился на текущую дату (проверка по дате регистрации и продолжительности курса) выводится соответствующее сообщение и **кнопка "Добавить в архив"**, которая перенаправляет на форму подтверждения добавления в архив. 
При выборе варианта "Принять" происходит:
* изменение статуса студента на 'finished';
* пользователь удаляется из группы Students и добвляется в группу Archived (ТОЛЬКО в случае, если с данным пользователем
нет связанных студентов, которые не являются активными студентами на других курсах. Иначе группа остается Students).

##### Архив
Ссылка переводит на страницу, на которой **в разезе курсов** выводится список студентов, закончивших обучение (статус finished). Для каждого студента указывается курс, фамилия и имя студента. 


Фамилия и имя студента во всех вышеуказанных ссылках раздела "Обучение", являются активными ссылками и ведут на страницу с **детальной информацией студента**. Наполнение данной страницы имеет некоторые различия в зависимости от статуса студента, и описано ниже. 

Детальная информация студента
- ФОТО (если есть);
- телефон;
- эл.почта;
- дата рождения;

Для тех, кто еще только подал заявку на обучение, но не подтвержден (статус required): 
- дата подачи заявки;
- кнопка "Обработать заявку" - ссылка на форму Подтверждения заявки (аналогично кнопке в списке "Заявки на обучение")
***вариант "Отклонить" на форме пока возвращает на страницу, на которой была нажата кнопка, планируется добавить туда деактивацию/удаление студента (is_deleted=True);

Для активных студентов и студентов, находящихся в архиве (статусы approved и finished):
- курс, на котором обучается студент;
- дата регистрации;
- средний балл (успеваемость) - пересчитывается автоматически при добавлении новых оценок;
- кнопка "Добавить в архив" (для студентов, у которых период обучения завершился, но они еще не переведены в архив) - 
перенаправляет на форму подтверждения добавления в архив, как такая же кнопка в списке "Студенты".
- пометка "Обучение завершено" (только для студентов в архиве);
- статус оплаты (оплачено частично, оплачено полностью, оплаты нет) - данный статус автоматически оперделяется при добавлении платежей;
- кнопка "Добавить данные по оплате" (кроме статуса "Оплачено полностью") - открывает форму добавления платежа по курсу. 
При этом в форме по умолчанию заполнено ФИО текущего студента, сумма оплаты (равная неоплаченному остатку), текущая дата;
При отправке формы дополнительно проверяется сумма (не должна превышать неоплаченный остаток) и дата платежа (не должна превышать текущую дату).

- блок "Данные оплаты", где отражается информация: 
* общая стоимость обучения;
* остаток для оплаты;
* данные по платежам (если платежей нет - соответствующее сообщение):
- сумма;
- дата оплаты;
- документ, подтверждающий оплату (ссылка). Если документ (файл) отсутствует, выводится соответствующее сообщение;
- кнопка "Редактировать платеж" - открывает форму добавления платежа, с той лишь разницей, что по умолчанию поля заполнены текущими данными по платежу (студент, дата платежа, сумма). 
Проверки при отправке формы срабатывает так же, как и при добавлении платежа. Но при расчете остатка к оплате 
учитывается тот факт, что платеж не добавляется, а изменяется уже существующий.

#### Оплата
Видимость данного раздела - только для пользователей группы Accountant (права на добавление/изменение платежей).
Раздел содержит одну ссылку - **"Добавить платеж"**. Кнопка открывает форму добавления платежа, где к выбору доступны все студенты. При этом в форме по умолчанию заполнена сумма оплаты (равная неоплаченному остатку) и текущая дата. кроме того, в форме есть поле ввода файла - документа оплаты. При отправке формы дополнительно проверяется сумма (не должна превышать неоплаченный остаток) и дата платежа (не должна превышать текущую дату).
## Различия функционала по правам доступа.

В настоящее время в приложении применяется разделение пользователей на 6 групп (с различием по доступам к функционалу сайта):
1) неавторизованные пользователи;
Авторизованные пользователи:
2) Студент (группа Students);
3) Студент в архиве (группа Archived - студенты, завершившие обучение);
4) Сотрудник (признак is_stuff);
5) Преподаватель (признак is_stuff, группа Teachers - права на добавление/изменение модели Performance);
6) Бухгалтер (признак is_stuff, группа Accountant - права на добавление/изменение модели Payment).

Ниже подробнее представляю описание доступных действий/просмотра для представителей каждой из групп. 

### Неавторизованный пользователь.
Неавторизованному пользователю доступны вкладки "Главная", "Курсы", "Контакты" и раздел "Авторизация". 

#### Вкладка Главная, Контакты
Ограничений нет.
#### Вкладка Курсы
Доступен список курсов (выбранной Категории), по которым предоставляется обучение. Для каждого курса отображается название и продолжительность.
НЕ отображается кнопка "Добавить оценки по курсу".
При клике на курс открывается его детальная информация, где видно описание курса, продолжительность, стоимость, рейтинг, отзывы. Тут же кнопка "Подать заявку", которая сначала перенаправит пользователя на страницу аутентификации (либо регистрации по ссылке на той же странице), и после аутентификации пользователь может перейти к выбранному курсу и подать заявку на обучение.
НЕ отображается Форма добавления отзыва, Список студентов курса

### Студент
Студенту доступны те же вкладки "Главная", "Курсы", "Контакты" и раздел "Авторизация", добавляется еще вкладка "Личный кабинет". 
#### Вкладка Главная, Контакты, Личный кабинет
Ограничений нет.
#### Вкладка Курсы
Аналогично, как и неавторизованному пользователю, доступен список курсов, по которым предоставляется обучение. Для каждого курса отображается название и продолжительность.
НЕ отображается кнопка "Добавить оценки по курсу".
На странице детальной информации по курсу добавляется возможность Оставить отзыв о курсе.
НЕ отображается Форма добавления отзыва, Список студентов курса

### Сотрудник
Помимо вкладок и разделов, описанных выше для студента, становится доступным раздел "Обучение" - Заявки на обучение, Студенты, Архив. 
#### Вкладка Главная, Контакты, Личный кабинет
Ограничений нет (хотя в личном кабинете нет информации, пока там предусмотрена информация только для студентов).
#### Вкладка Курсы
Аналогично доступен список курсов, по которым предоставляется обучение. Для каждого курса отображается название и продолжительность.
НЕ отображается кнопка "Добавить оценки по курсу".
На странице детальной информации по курсу виден блок общей информации о курсе (краткое описание, продолжительность, полная цена, рейтинг), Отзывы по курсу (без возможности добавления отзыва), Список студентов курса.
Т.о. НЕ отображается только Форма добавления отзыва.
В списке студентов курса ФИО студента является кликабельной ссылкой, которая переводит на страницу с детальной информацией по студенту. Здесь отображется вся инфомация, кроме возможности добавлять/редактировать платежи.
НЕ отображаются Кнопки "Добавить данные по оплате", "Редактировать платеж".
Также недоступным остается раздел "Оплата" на боковой панели навигации, как и для Студентов и Неавторизованных пользователей.

### Преподаватель 
Набор доступов сходен с Сотрудником. 
Отличие в том, что на странице списка курсов для преподавателей также отображается кнопка "Добавить оценки по курсу"

### Бухгалтер
Набор доступов сходен с Сотрудником. Отличия: 
* на боковой панели отображается раздел "Оплата" со ссылкой "Добавить платеж"
* на странице с детальной информацией студента есть кнопки "Добавить данные по оплате" и "Редактировать платеж".